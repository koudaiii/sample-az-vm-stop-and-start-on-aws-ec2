#cloud-config
# Cloud-init configuration for EC2 instance with Azure CLI

package_update: true
package_upgrade: true

packages:
  - git
  - jq

yum_repos:
  azure-cli:
    name: Azure CLI
    baseurl: https://packages.microsoft.com/yumrepos/azure-cli
    enabled: true
    gpgcheck: true
    gpgkey: https://packages.microsoft.com/keys/microsoft.asc

runcmd:
  # Import Microsoft GPG key
  - rpm --import https://packages.microsoft.com/keys/microsoft.asc
  
  # Install Azure CLI
  - yum install -y azure-cli
  
  # Verify installations
  - az version
  - git --version
  - jq --version
  - git clone https://github.com/koudaiii/sample-az-vm-stop-and-start-on-aws-ec2.git
  
  # Log completion
  - echo "Cloud-init setup completed successfully" >> /var/log/cloud-init-custom.log

final_message: "Cloud-init setup completed at $TIMESTAMP"
